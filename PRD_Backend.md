# ğŸš€ MAINLY ë°±ì—”ë“œ/DB ì™„ì „ êµ¬í˜„ ê³„íšì„œ (v3.0 - ì¹˜ëª…ì  ìœ„í—˜ í•´ê²°íŒ)

## ğŸ†• **v3.0 ì¹˜ëª…ì  ìœ„í—˜ ê°œì„ ì‚¬í•­ (2025-09-11 ì¶”ê°€)**

### ğŸ”¥ **ì‹ ê·œ ì¶”ê°€ ê¸°ëŠ¥ (ì¹˜ëª…ì  ìœ„í—˜ 3ê°œ í•´ê²°)**
1. âœ… **ê¶Œí•œ ìœ„ì„ ì‹œìŠ¤í…œ** - íœ´ê°€/ì¶œì¥ ì‹œ ì—…ë¬´ ì—°ì†ì„± ë³´ì¥
   - `permission_delegations` í…Œì´ë¸” ì¶”ê°€
   - í•œì‹œì  ê¶Œí•œ ìœ„ì„ API êµ¬í˜„
   - ìŠ¹ì¸ í”„ë¡œì„¸ìŠ¤ í¬í•¨

2. âœ… **íŒ€ ë³€ê²½ ë°ì´í„° ì²˜ë¦¬** - ì¡°ì§ê°œí¸ ì‹œ ì²´ê³„ì  ì²˜ë¦¬
   - íŒ€ ë³€ê²½ í”„ë¡œì„¸ìŠ¤ API (`/api/users/:id/team-change`)
   - ì—…ë¬´ ì¸ìˆ˜ì¸ê³„ ìë™í™”
   - ê¶Œí•œ ì¬ì¡°ì • ë¡œì§

3. âœ… **ì‚¬ìš©ì í‡´ì‚¬ í”„ë¡œì„¸ìŠ¤** - ì—…ë¬´ ê³µë°± ë°©ì§€
   - `resignation_processes` í…Œì´ë¸” ì¶”ê°€
   - í‡´ì‚¬ ì²´í¬ë¦¬ìŠ¤íŠ¸ ìë™ ìƒì„±
   - ì—…ë¬´/íŒŒì¼/ê¶Œí•œ ì´ê´€ ì¶”ì 

### ğŸ› ï¸ **ê°œì„  ì‚¬í•­ (ì•½ì  3ê°œ ë³´ì™„)**
4. âœ… **ë³µìˆ˜ íŒ€ ì†Œì† ì§€ì›** - í˜‘ì—…/ê²¸ì§ ì‹œë‚˜ë¦¬ì˜¤ ëŒ€ì‘
   - `user_team_mappings` í…Œì´ë¸” ì¶”ê°€
   - ì£¼/ë¶€ ì†Œì†íŒ€ êµ¬ë¶„
   - íŒ€ë³„ ì—­í•  ë¶„ë¦¬

5. âœ… **KPI-ì—…ë¬´ ë™ê¸°í™” ê°•í™”** - ë°ì´í„° ì¼ê´€ì„± ë³´ì¥
   - `KpiTaskSyncService` êµ¬í˜„
   - KPI ì‚­ì œ ì •ì±… ëª…í™•í™”
   - ë³€ê²½ ì´ë ¥ ìë™ ì¶”ì 

6. âœ… **í˜„ì‹¤ì  ì¼ì • ì¡°ì •** - 9-10ì£¼ë¡œ í™•ëŒ€
   - ê¶Œí•œ ì²´ê³„ êµ¬í˜„ ì‹œê°„ ì¶”ê°€ (0.5ì£¼)
   - ì—…ë¬´ê´€ë¦¬ ë²„í¼ ì¶”ê°€ (0.5ì£¼)
   - í•„ìˆ˜ ë¦¬ìŠ¤í¬ ë²„í¼ í™•ë³´ (1.5ì£¼)

## ğŸ“‹ **v2.0 ì£¼ìš” ê°œì„ ì‚¬í•­ (ê²€ì¦ ê²°ê³¼ ë°˜ì˜)**

### ğŸ”¥ **ê¸´ê¸‰ ìˆ˜ì •ì‚¬í•­ (HIGH Priority)**
1. âœ… **ì²´í¬ë¦¬ìŠ¤íŠ¸ `progress_rate INTEGER` í•„ë“œ ì¶”ê°€** - ì§„ì²™ìœ¨ ê´€ë¦¬ ê¸°ëŠ¥ ë³µì›
2. âœ… **ì²´í¬ë¦¬ìŠ¤íŠ¸ `expanded BOOLEAN` í•„ë“œ ì¶”ê°€** - UI ìƒíƒœ ê´€ë¦¬ ì§€ì›
3. âœ… **í•„ìˆ˜ ì„±ëŠ¥ ì¸ë±ìŠ¤ ì„¤ê³„ ì¶”ê°€** - ê²€ìƒ‰ ì„±ëŠ¥ ëŒ€í­ í–¥ìƒ
4. âœ… **íŒŒì¼ ì—…ë¡œë“œ ë³´ì•ˆ ì •ì±… ê°•í™”** - í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜ ê²€ì¦
5. âœ… **í˜„ì‹¤ì  êµ¬í˜„ ì¼ì • ì¡°ì •** - 5-6ì£¼ â†’ 7-8ì£¼ (40% ì¦ê°€)

### ğŸ› ï¸ **êµ¬ì¡°ì  ê°œì„ ì‚¬í•­ (MEDIUM Priority)**
6. âœ… **íŒŒì¼ ì‹œìŠ¤í…œ FK ê´€ê³„ ê°œì„ ** - ë‹¤í˜•ì„± â†’ ê°œë³„ í…Œì´ë¸”ë¡œ ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥
7. âœ… **API ê¶Œí•œ Guard êµ¬í˜„ ì„¸ë¶€ì‚¬í•­ ëª…ì‹œ** - RolesGuard, TeamAccessGuard êµ¬ì²´í™”
8. âœ… **ìºì‹± ì „ëµ ìˆ˜ë¦½** - Redis ê¸°ë°˜ ë§ˆìŠ¤í„°ì½”ë“œ/ê¶Œí•œ ìºì‹±
9. âœ… **ì¿¼ë¦¬ ìµœì í™” ì „ëµ** - CTE ê¸°ë°˜ ê³„ì¸µêµ¬ì¡° íš¨ìœ¨ì  ì¡°íšŒ

### ğŸ“ˆ **ì„±ëŠ¥ ìµœì í™” ì¶”ê°€**
10. âœ… **20ê°œ í•µì‹¬ ì¸ë±ìŠ¤ ì„¤ê³„** - ì—…ë¬´/KPI/ì²´í¬ë¦¬ìŠ¤íŠ¸/íŒŒì¼ ì¡°íšŒ ìµœì í™”
11. âœ… **ë…¼ë¦¬ì‚­ì œ ì¸ë±ìŠ¤ ì¶”ê°€** - WHERE deleted_at IS NULL ì„±ëŠ¥ ë³´ì¥
12. âœ… **ê°ì‚¬ë¡œê·¸ íŒŒí‹°ì…”ë‹ ê³ ë ¤** - ì¥ê¸° ì„±ëŠ¥ ì €í•˜ ë°©ì§€

### ğŸ” **ë³´ì•ˆ ê°•í™” ì¶”ê°€**
13. âœ… **íŒŒì¼ íƒ€ì… í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸** - PDF, Office, ì´ë¯¸ì§€ë§Œ í—ˆìš©
14. âœ… **íŒŒì¼ëª… ê²€ì¦ ì •ê·œì‹** - ê²½ë¡œ ì¡°ì‘ ê³µê²© ë°©ì§€
15. âœ… **ì••ì¶•íŒŒì¼ ìŠ¤ìº” ì •ì±…** - ZIP/RAR ë“± ì•…ì„±ì½”ë“œ ìŠ¤ìº” í•„ìˆ˜

### â° **ì¼ì • í˜„ì‹¤í™”**
16. âœ… **MVP ìš°ì„ ìˆœìœ„ ì „ëµ** - ì—…ë¬´ê´€ë¦¬+KPIê´€ë¦¬ ì™„ë²½ êµ¬í˜„ ìš°ì„ 
17. âœ… **ìœ„í—˜ ì™„í™” ì „ëµ** - ë‹¨ê³„ì  ë³µì¡ë„ ì¦ê°€ (ê¸°ë³¸â†’ê³ ê¸‰â†’ìµœì í™”)
18. âœ… **ì—°ë™ ì‹œê°„ ì¶©ë¶„ í™•ë³´** - í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ 1ì£¼ì¼ ì „ìš©

## ğŸ“Š **ê¸°ìˆ  ìŠ¤íƒ & ì•„í‚¤í…ì²˜**

### í•µì‹¬ ê¸°ìˆ 
```
Backend: NestJS (Node.js 18+)
Database: PostgreSQL 15
ORM: Prisma
Authentication: JWT + Passport
File Storage: Local Server (100MB limit) â†’ í–¥í›„ AWS S3 ë§ˆì´ê·¸ë ˆì´ì…˜
API Docs: Swagger/OpenAPI
Caching: Redis (ì„¸ì…˜, ì„ì‹œë°ì´í„°)
Scheduler: @nestjs/schedule (Cron jobs)
AI Integration: External API ì—°ë™
```

### í´ë” êµ¬ì¡°
```
mainly-backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ auth/              # ì¸ì¦ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ admin/             # ê´€ë¦¬ì ë©”ë‰´ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ main/              # ë©”ì¸ ë©”ë‰´ ëª¨ë“ˆ  
â”‚   â”œâ”€â”€ planning/          # ê¸°íš ë©”ë‰´ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ it/                # IT ë©”ë‰´ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ security/          # ë³´ì•ˆ ë©”ë‰´ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ ai/                # AI ëŒ€í™” ëª¨ë“ˆ
â”‚   â”œâ”€â”€ common/            # ê³µí†µ ëª¨ë“ˆ
â”‚   â”œâ”€â”€ files/             # íŒŒì¼ ì²˜ë¦¬
â”‚   â””â”€â”€ notifications/     # ì•Œë¦¼ ì‹œìŠ¤í…œ
â”œâ”€â”€ prisma/
â”‚   â”œâ”€â”€ schema.prisma
â”‚   â”œâ”€â”€ migrations/
â”‚   â””â”€â”€ seeds/
â””â”€â”€ uploads/               # íŒŒì¼ ì €ì¥ì†Œ
```

## ğŸ—„ï¸ **ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„ (í˜„ì¬ í”„ë¡ íŠ¸ì—”ë“œ ê¸°ë°˜)**

### Phase 1: ê¸°ë°˜ + ê´€ë¦¬ì ë©”ë‰´ í…Œì´ë¸”

```sql
-- ì‚¬ìš©ì & ì¡°ì§ (í˜„ì¬ ì½”ë“œ ê¸°ë°˜)
users (
  id BIGSERIAL PRIMARY KEY,
  email VARCHAR(255) UNIQUE NOT NULL,
  password VARCHAR(255) NOT NULL,
  name VARCHAR(100) NOT NULL,
  position VARCHAR(50), -- 'ë³¸ë¶€ì¥', 'íŒ€ì¥', 'íŒŒíŠ¸ì¥', 'í”„ë¡œ'
  team VARCHAR(50), -- 'ê°œë°œíŒ€', 'ë””ìì¸íŒ€', 'ê¸°íšíŒ€', 'ë§ˆì¼€íŒ…íŒ€'
  department VARCHAR(50), -- 'IT', 'ê¸°íš'
  role VARCHAR(20) DEFAULT 'member', -- 'system_admin', 'team_leader', 'part_leader', 'member'
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP NULL
);

-- ë§ˆìŠ¤í„°ì½”ë“œ (í–¥í›„ í™•ì¥ìš©)
master_codes (
  id BIGSERIAL PRIMARY KEY,
  category VARCHAR(50) NOT NULL, -- 'position', 'team', 'department', 'task_status' ë“±
  code VARCHAR(50) NOT NULL,
  name VARCHAR(100) NOT NULL,
  parent_id BIGINT REFERENCES master_codes(id),
  sort_order INTEGER DEFAULT 0,
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP NULL,
  UNIQUE(category, code)
);

-- ì‹œìŠ¤í…œ ì„¤ì •
system_settings (
  id BIGSERIAL PRIMARY KEY,
  setting_key VARCHAR(100) UNIQUE NOT NULL,
  setting_value TEXT,
  description TEXT,
  setting_type VARCHAR(50), -- 'string', 'number', 'boolean', 'json'
  updated_by BIGINT REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- ì²´í¬ë¦¬ìŠ¤íŠ¸ í…œí”Œë¦¿
checklist_templates (
  id BIGSERIAL PRIMARY KEY,
  name VARCHAR(200) NOT NULL,
  category VARCHAR(100),
  template_data JSONB, -- í…œí”Œë¦¿ êµ¬ì¡° ì €ì¥
  created_by BIGINT REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP NULL
);

-- ì‚¬ìš©ì ì„¤ì •
user_settings (
  id BIGSERIAL PRIMARY KEY,
  user_id BIGINT REFERENCES users(id),
  setting_key VARCHAR(100) NOT NULL,
  setting_value TEXT,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id, setting_key)
);

-- íŒŒì¼ ì‹œìŠ¤í…œ (ğŸ”¥ ê²€ì¦ ê²°ê³¼ ê°œì„ )
-- ë°©ë²• 1: ê°œë³„ í…Œì´ë¸” (ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥)
task_files (
  id BIGSERIAL PRIMARY KEY,
  task_id BIGINT REFERENCES tasks(id) ON DELETE CASCADE,
  original_name VARCHAR(255) NOT NULL,
  stored_name VARCHAR(255) NOT NULL,
  file_path VARCHAR(500) NOT NULL,
  file_size BIGINT NOT NULL,
  mime_type VARCHAR(100),
  uploaded_by BIGINT REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP NULL
);

kpi_files (
  id BIGSERIAL PRIMARY KEY,
  kpi_id BIGINT REFERENCES kpis(id) ON DELETE CASCADE,
  original_name VARCHAR(255) NOT NULL,
  stored_name VARCHAR(255) NOT NULL,
  file_path VARCHAR(500) NOT NULL,
  file_size BIGINT NOT NULL,
  mime_type VARCHAR(100),
  uploaded_by BIGINT REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP NULL
);

cost_files (
  id BIGSERIAL PRIMARY KEY,
  cost_id BIGINT REFERENCES costs(id) ON DELETE CASCADE,
  original_name VARCHAR(255) NOT NULL,
  stored_name VARCHAR(255) NOT NULL,
  file_path VARCHAR(500) NOT NULL,
  file_size BIGINT NOT NULL,
  mime_type VARCHAR(100),
  uploaded_by BIGINT REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP NULL
);

-- ê°ì‚¬ë¡œê·¸ (ëª¨ë“  ë³€ê²½ì‚¬í•­ ì¶”ì )
audit_logs (
  id BIGSERIAL PRIMARY KEY,
  entity_type VARCHAR(50) NOT NULL, -- 'task', 'kpi', 'cost' ë“±
  entity_id BIGINT NOT NULL,
  action VARCHAR(20) NOT NULL, -- 'create', 'update', 'delete'
  field_name VARCHAR(100),
  old_value TEXT,
  new_value TEXT,
  user_id BIGINT REFERENCES users(id),
  ip_address INET,
  user_agent TEXT,
  created_at TIMESTAMP DEFAULT NOW()
);
```

### Phase 2: ë©”ì¸ ë©”ë‰´ í…Œì´ë¸” (í˜„ì¬ í”„ë¡ íŠ¸ì—”ë“œì™€ ì™„ì „ ì¼ì¹˜)

```sql
-- ì—…ë¬´ê´€ë¦¬ (TaskEditDialog ê¸°ë°˜)
tasks (
  id BIGSERIAL PRIMARY KEY,
  code VARCHAR(50) UNIQUE NOT NULL,
  work_content TEXT NOT NULL, -- í”„ë¡ íŠ¸ì—”ë“œì˜ workContent
  description TEXT,
  task_type VARCHAR(10) DEFAULT 'ì¼ë°˜', -- 'ì¼ë°˜', 'KPI'
  status VARCHAR(20) DEFAULT 'ëŒ€ê¸°', -- 'ëŒ€ê¸°', 'ì§„í–‰', 'ì™„ë£Œ', 'í™€ë”©'
  assignee VARCHAR(100), -- ë‹´ë‹¹ìëª… (í˜„ì¬ëŠ” ë¬¸ìì—´)
  team VARCHAR(50), -- 'ê°œë°œíŒ€', 'ë””ìì¸íŒ€', 'ê¸°íšíŒ€', 'ë§ˆì¼€íŒ…íŒ€'
  department VARCHAR(50), -- 'IT', 'ê¸°íš'
  progress INTEGER DEFAULT 0, -- 0-100
  priority VARCHAR(20), -- 'High', 'Medium', 'Low'
  registration_date DATE, -- ë“±ë¡ì¼ (í”„ë¡ íŠ¸ì—”ë“œ í•„ë“œ)
  start_date DATE, -- ì‹œì‘ì¼
  completed_date DATE, -- ì™„ë£Œì¼
  loaded_kpi_title VARCHAR(200), -- KPI ë¶ˆëŸ¬ì˜¤ê¸°ì—ì„œ ê°€ì ¸ì˜¨ ì œëª©
  loaded_kpi_id BIGINT, -- ì—°ê²°ëœ KPI ID (í–¥í›„ FK ì¶”ê°€ ì˜ˆì •)
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP NULL
);

-- ì—…ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸ (ê³„ì¸µêµ¬ì¡° ì§€ì›)
task_checklists (
  id BIGSERIAL PRIMARY KEY,
  task_id BIGINT REFERENCES tasks(id) ON DELETE CASCADE,
  content TEXT NOT NULL,
  checked BOOLEAN DEFAULT false,
  parent_id BIGINT REFERENCES task_checklists(id),
  level INTEGER DEFAULT 0, -- 0: ìµœìƒìœ„, 1: 1ë‹¨ê³„ í•˜ìœ„...
  weight INTEGER, -- ë¹„ì¤‘ë„ (%)
  priority VARCHAR(20), -- 'High', 'Medium', 'Low'
  status VARCHAR(20) DEFAULT 'ëŒ€ê¸°', -- 'ëŒ€ê¸°', 'ì§„í–‰', 'ì™„ë£Œ', 'ì·¨ì†Œ'
  progress_rate INTEGER DEFAULT 0, -- 0-100 ì§„ì²™ìœ¨ (ğŸ”¥ ê²€ì¦ ê²°ê³¼ ì¶”ê°€)
  assignee VARCHAR(100), -- ë‹´ë‹¹ì
  team VARCHAR(50), -- íŒ€
  start_date DATE,
  due_date DATE,
  sort_order INTEGER DEFAULT 0, -- ë“œë˜ê·¸ì•¤ë“œë¡­ ìˆœì„œ
  expanded BOOLEAN DEFAULT true, -- UI í™•ì¥/ì¶•ì†Œ ìƒíƒœ
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP NULL
);

-- ì—…ë¬´ ëŒ“ê¸€/ì½”ë©˜íŠ¸
task_comments (
  id BIGSERIAL PRIMARY KEY,
  task_id BIGINT REFERENCES tasks(id) ON DELETE CASCADE,
  content TEXT NOT NULL,
  author VARCHAR(100) NOT NULL,
  author_id BIGINT REFERENCES users(id),
  avatar_url VARCHAR(500),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP NULL
);

-- KPIê´€ë¦¬ (KpiEditDialog ê¸°ë°˜)
kpis (
  id BIGSERIAL PRIMARY KEY,
  code VARCHAR(50) UNIQUE NOT NULL,
  work_content TEXT NOT NULL, -- KPI ì œëª© (TaskDataì™€ ë™ì¼ í•„ë“œëª…)
  description TEXT,
  status VARCHAR(20) DEFAULT 'ëŒ€ê¸°', -- 'ëŒ€ê¸°', 'ì§„í–‰', 'ì™„ë£Œ', 'í™€ë”©'
  assignee VARCHAR(100), -- ë‹´ë‹¹ìëª…
  team VARCHAR(50), -- 'ê°œë°œíŒ€', 'ë””ìì¸íŒ€', 'ê¸°íšíŒ€', 'ë§ˆì¼€íŒ…íŒ€'
  department VARCHAR(50), -- 'IT', 'ê¸°íš'
  progress INTEGER DEFAULT 0, -- 0-100
  weight INTEGER DEFAULT 100, -- ë¹„ì¤‘ë„ (%)
  priority VARCHAR(20), -- 'High', 'Medium', 'Low'
  registration_date DATE, -- ë“±ë¡ì¼
  start_date DATE, -- ì‹œì‘ì¼
  completed_date DATE, -- ì™„ë£Œì¼
  is_locked BOOLEAN DEFAULT false, -- ì—…ë¬´ì—ì„œ ë¶ˆëŸ¬ì˜¨ ê²½ìš° true
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP NULL
);

-- KPI ì²´í¬ë¦¬ìŠ¤íŠ¸ (tasksì™€ ë™ì¼ êµ¬ì¡°)
kpi_checklists (
  id BIGSERIAL PRIMARY KEY,
  kpi_id BIGINT REFERENCES kpis(id) ON DELETE CASCADE,
  content TEXT NOT NULL,
  checked BOOLEAN DEFAULT false,
  parent_id BIGINT REFERENCES kpi_checklists(id),
  level INTEGER DEFAULT 0,
  weight INTEGER,
  priority VARCHAR(20),
  status VARCHAR(20) DEFAULT 'ëŒ€ê¸°',
  progress_rate INTEGER DEFAULT 0, -- 0-100 ì§„ì²™ìœ¨ (ğŸ”¥ ê²€ì¦ ê²°ê³¼ ì¶”ê°€)
  assignee VARCHAR(100),
  team VARCHAR(50),
  start_date DATE,
  due_date DATE,
  sort_order INTEGER DEFAULT 0, -- ë“œë˜ê·¸ì•¤ë“œë¡­ ìˆœì„œ
  expanded BOOLEAN DEFAULT true, -- UI í™•ì¥/ì¶•ì†Œ ìƒíƒœ
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP NULL
);

-- KPI ëŒ“ê¸€/ì½”ë©˜íŠ¸
kpi_comments (
  id BIGSERIAL PRIMARY KEY,
  kpi_id BIGINT REFERENCES kpis(id) ON DELETE CASCADE,
  content TEXT NOT NULL,
  author VARCHAR(100) NOT NULL,
  author_id BIGINT REFERENCES users(id),
  avatar_url VARCHAR(500),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP NULL
);

-- ì¼ì •ê´€ë¦¬
calendar_events (
  id BIGSERIAL PRIMARY KEY,
  title VARCHAR(200) NOT NULL,
  description TEXT,
  start_date TIMESTAMP NOT NULL,
  end_date TIMESTAMP,
  all_day BOOLEAN DEFAULT false,
  location VARCHAR(200),
  attendees JSONB, -- ì°¸ì„ì ëª©ë¡
  event_type VARCHAR(50), -- ì´ë²¤íŠ¸ ìœ í˜•
  created_by BIGINT REFERENCES users(id),
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP NULL
);

-- ê°œì¸êµìœ¡ê´€ë¦¬
personal_educations (
  id BIGSERIAL PRIMARY KEY,
  title VARCHAR(200) NOT NULL,
  category VARCHAR(100),
  education_type VARCHAR(50), -- 'ì˜¨ë¼ì¸', 'ì˜¤í”„ë¼ì¸', 'í˜¼í•©'
  status VARCHAR(20) DEFAULT 'ê³„íš', -- 'ê³„íš', 'ì§„í–‰ì¤‘', 'ì™„ë£Œ', 'ì·¨ì†Œ'
  start_date DATE,
  end_date DATE,
  instructor VARCHAR(100),
  location VARCHAR(200),
  participant_id BIGINT REFERENCES users(id),
  completion_rate INTEGER DEFAULT 0, -- ì´ìˆ˜ìœ¨ 0-100
  score INTEGER, -- ì ìˆ˜
  certificate_issued BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP NULL
);

-- ë¹„ìš©ê´€ë¦¬
costs (
  id BIGSERIAL PRIMARY KEY,
  code VARCHAR(50) UNIQUE NOT NULL,
  category VARCHAR(100), -- 'ì¸ê±´ë¹„', 'ìš´ì˜ë¹„', 'ê°œë°œë¹„', 'ë§ˆì¼€íŒ…ë¹„', 'ê¸°íƒ€'
  amount DECIMAL(15,2) NOT NULL,
  description TEXT,
  status VARCHAR(20) DEFAULT 'ì‹ ì²­', -- 'ì‹ ì²­', 'ìŠ¹ì¸', 'ë°˜ë ¤', 'ì™„ë£Œ'
  payment_method VARCHAR(50), -- 'ì¹´ë“œ', 'í˜„ê¸ˆ', 'ê³„ì¢Œì´ì²´'
  requested_by BIGINT REFERENCES users(id),
  approved_by BIGINT REFERENCES users(id),
  request_date DATE DEFAULT CURRENT_DATE,
  approval_date DATE,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW(),
  deleted_at TIMESTAMP NULL
);

-- ëŒ€ì‹œë³´ë“œ ìœ„ì ¯ ì„¤ì •
dashboard_widgets (
  id BIGSERIAL PRIMARY KEY,
  user_id BIGINT REFERENCES users(id),
  widget_type VARCHAR(50) NOT NULL, -- 'my_tasks', 'team_kpi', 'cost_status', 'schedule', 'notice'
  position_x INTEGER DEFAULT 0,
  position_y INTEGER DEFAULT 0,
  width INTEGER DEFAULT 1,
  height INTEGER DEFAULT 1,
  config_json JSONB, -- ìœ„ì ¯ë³„ ì„¤ì • ì €ì¥
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);
```

### Phase 3: ê¸°íš ë©”ë‰´ í…Œì´ë¸”

```sql
-- ë§¤ì¶œê´€ë¦¬
sales (id, period, revenue, target, category_id, region, created_by, notes, deleted_at)
sales_details (id, sales_id, product_name, quantity, unit_price, total_amount)

-- íˆ¬ìê´€ë¦¬
investments (id, project_name, category_id, investment_amount, expected_return, start_date, end_date, status_id, manager_id, deleted_at)
investment_milestones (id, investment_id, milestone_name, target_date, completion_date, status_id, notes)
```

### Phase 4: IT ë©”ë‰´ í…Œì´ë¸”

```sql
-- VOCê´€ë¦¬
vocs (id, title, content, customer_name, contact, voc_type_id, channel_id, priority_id, status_id, assignee_id, received_date, resolved_date, deleted_at)
voc_responses (id, voc_id, response_content, responder_id, response_date)

-- ì†”ë£¨ì…˜ê´€ë¦¬
solutions (id, name, vendor, version, category_id, license_type_id, purchase_date, expiry_date, license_count, assigned_count, status_id, deleted_at)
solution_assignments (id, solution_id, user_id, assigned_date, returned_date, notes)

-- í•˜ë“œì›¨ì–´ê´€ë¦¬
hardware_assets (id, asset_tag, name, category_id, model, serial_number, purchase_date, warranty_expiry, status_id, location, assignee_id, deleted_at)
hardware_maintenance (id, hardware_id, maintenance_type, maintenance_date, next_due_date, vendor, cost, notes)

-- ì†Œí”„íŠ¸ì›¨ì–´ê´€ë¦¬
software_assets (id, name, vendor, version, category_id, license_type_id, license_key, purchase_date, expiry_date, license_count, installed_count, status_id, deleted_at)
software_licenses (id, software_id, user_id, installation_date, activation_key, status_id)

-- ITêµìœ¡ê´€ë¦¬
it_educations (id, title, category_id, instructor, start_date, end_date, max_participants, status_id, deleted_at)
it_education_participants (id, education_id, user_id, enrollment_date, completion_date, score, status_id)
```

### Phase 5: ë³´ì•ˆ ë©”ë‰´ í…Œì´ë¸”

```sql
-- ë³´ì•ˆì ê²€ê´€ë¦¬
security_inspections (id, title, category_id, inspection_date, next_due_date, inspector_id, status_id, overall_score, deleted_at)
inspection_items (id, inspection_id, item_name, check_result, score, notes, checked_by)

-- ë³´ì•ˆêµìœ¡ê´€ë¦¬
security_educations (id, title, education_type_id, mandatory, start_date, end_date, instructor, max_participants, deleted_at)
security_education_participants (id, education_id, user_id, enrollment_date, completion_date, certificate_issued, status_id)

-- ë³´ì•ˆì‚¬ê³ ê´€ë¦¬
security_incidents (id, incident_title, incident_type_id, severity_id, occurred_date, detected_date, reporter_id, assignee_id, status_id, resolution_date, deleted_at)
incident_actions (id, incident_id, action_description, action_date, performer_id, action_type_id)

-- ë³´ì•ˆê·œì •ê´€ë¦¬
security_regulations (id, title, category_id, version, effective_date, approval_date, approved_by, status_id, deleted_at)
regulation_views (id, regulation_id, user_id, viewed_date, acknowledged)
```

### Phase 6: AI ëŒ€í™” í…Œì´ë¸”

```sql
-- AI ëŒ€í™”
ai_conversations (id, user_id, session_id, user_message, ai_response, context_data_json, created_at)
ai_prompts (id, name, category, prompt_template, is_active, created_by, created_at)
```

## ğŸ—‚ï¸ **í•˜ì´ë¸Œë¦¬ë“œ ë§ˆìŠ¤í„°ì½”ë“œ ê´€ë¦¬ ì „ëµ**

### **Phase 1: í˜„ì¬ ì½”ë“œ ê¸°ë°˜ (ì¦‰ì‹œ êµ¬í˜„ ê°€ëŠ¥)**
```sql
-- 1ë‹¨ê³„: í˜„ì¬ í”„ë¡ íŠ¸ì—”ë“œì™€ ì¼ì¹˜í•˜ëŠ” ê³ ì •ê°’ ì‚¬ìš©
-- ë°±ì—”ë“œì—ì„œ validationìœ¼ë¡œ ì œí•œ
```

#### **ê¸°ë³¸ ì½”ë“œë“¤ (ê³ ì •ê°’ â†’ ë§ˆìŠ¤í„°ì½”ë“œ)**
```typescript
// í˜„ì¬: í•˜ë“œì½”ë”©
const POSITIONS = ['ë³¸ë¶€ì¥', 'íŒ€ì¥', 'íŒŒíŠ¸ì¥', 'í”„ë¡œ'];
const TEAMS = ['ê°œë°œíŒ€', 'ë””ìì¸íŒ€', 'ê¸°íšíŒ€', 'ë§ˆì¼€íŒ…íŒ€'];
const DEPARTMENTS = ['IT', 'ê¸°íš'];
const TASK_STATUS = ['ëŒ€ê¸°', 'ì§„í–‰', 'ì™„ë£Œ', 'í™€ë”©'];
const PRIORITIES = ['High', 'Medium', 'Low'];

// í–¥í›„: ë§ˆìŠ¤í„°ì½”ë“œ í™•ì¥
GET /api/master-codes/positions
GET /api/master-codes/teams
GET /api/master-codes/departments
GET /api/master-codes/task-status
GET /api/master-codes/priorities
```

#### **ì—…ë¬´ê´€ë¦¬ ê´€ë ¨**
```typescript
const TASK_TYPES = ['ì¼ë°˜', 'KPI'];
const TASK_CATEGORIES = ['ê°œë°œ', 'ë””ìì¸', 'ê¸°íš', 'ë§ˆì¼€íŒ…', 'ê¸°íƒ€'];
```

#### **ë¹„ìš©ê´€ë¦¬ ê´€ë ¨**
```typescript
const COST_CATEGORIES = ['ì¸ê±´ë¹„', 'ìš´ì˜ë¹„', 'ê°œë°œë¹„', 'ë§ˆì¼€íŒ…ë¹„', 'ê¸°íƒ€'];
const COST_STATUS = ['ì‹ ì²­', 'ìŠ¹ì¸', 'ë°˜ë ¤', 'ì™„ë£Œ'];
const PAYMENT_METHODS = ['ì¹´ë“œ', 'í˜„ê¸ˆ', 'ê³„ì¢Œì´ì²´'];
```

#### **êµìœ¡ê´€ë¦¬ ê´€ë ¨**
```typescript
const EDUCATION_TYPES = ['ì˜¨ë¼ì¸', 'ì˜¤í”„ë¼ì¸', 'í˜¼í•©'];
const EDUCATION_STATUS = ['ê³„íš', 'ì§„í–‰ì¤‘', 'ì™„ë£Œ', 'ì·¨ì†Œ'];
const EDUCATION_TARGETS = ['ì „ì§ì›', 'ì‹ ì…', 'íŒ€ì¥ê¸‰', 'ì„ íƒ'];
```

### **Phase 2: ì ì§„ì  ë§ˆìŠ¤í„°ì½”ë“œ ë„ì…**
```sql
-- ë§ˆìŠ¤í„°ì½”ë“œ ì´ˆê¸° ë°ì´í„° ì‚½ì…
INSERT INTO master_codes (category, code, name, sort_order) VALUES
-- ì§ê¸‰
('position', 'executive', 'ë³¸ë¶€ì¥', 1),
('position', 'team_leader', 'íŒ€ì¥', 2),
('position', 'part_leader', 'íŒŒíŠ¸ì¥', 3),
('position', 'professional', 'í”„ë¡œ', 4),

-- íŒ€
('team', 'dev', 'ê°œë°œíŒ€', 1),
('team', 'design', 'ë””ìì¸íŒ€', 2),
('team', 'planning', 'ê¸°íšíŒ€', 3),
('team', 'marketing', 'ë§ˆì¼€íŒ…íŒ€', 4),

-- ë¶€ì„œ
('department', 'it', 'IT', 1),
('department', 'planning', 'ê¸°íš', 2),

-- ì—…ë¬´ìƒíƒœ
('task_status', 'waiting', 'ëŒ€ê¸°', 1),
('task_status', 'in_progress', 'ì§„í–‰', 2),
('task_status', 'completed', 'ì™„ë£Œ', 3),
('task_status', 'on_hold', 'í™€ë”©', 4);
```

### **Phase 3: í•˜ì´ë¸Œë¦¬ë“œ API ì„¤ê³„**
```typescript
// í˜„ì¬ í˜¸í™˜ì„± ìœ ì§€í•˜ë©´ì„œ í™•ì¥ì„± ë³´ì¥
interface TaskCreateRequest {
  workContent: string;
  description?: string;
  taskType: 'ì¼ë°˜' | 'KPI'; // í˜„ì¬ ê·¸ëŒ€ë¡œ
  status: 'ëŒ€ê¸°' | 'ì§„í–‰' | 'ì™„ë£Œ' | 'í™€ë”©'; // í˜„ì¬ ê·¸ëŒ€ë¡œ
  assignee: string; // í˜„ì¬ ê·¸ëŒ€ë¡œ (í–¥í›„ user_idë¡œ í™•ì¥)
  team: 'ê°œë°œíŒ€' | 'ë””ìì¸íŒ€' | 'ê¸°íšíŒ€' | 'ë§ˆì¼€íŒ…íŒ€'; // í˜„ì¬ ê·¸ëŒ€ë¡œ
  department: 'IT' | 'ê¸°íš'; // í˜„ì¬ ê·¸ëŒ€ë¡œ
  // ... ê¸°íƒ€ í•„ë“œë“¤
}

// ë°±ì—”ë“œ validation
class TaskService {
  async createTask(data: TaskCreateRequest) {
    // 1ë‹¨ê³„: ê³ ì •ê°’ validation
    if (!TEAMS.includes(data.team)) {
      throw new BadRequestException('Invalid team');
    }
    
    // 2ë‹¨ê³„: ë§ˆìŠ¤í„°ì½”ë“œ í™•ì¥ ì‹œ
    // const teamExists = await this.masterCodeService.exists('team', data.team);
    // if (!teamExists) throw new BadRequestException('Invalid team');
    
    return this.taskRepository.save(data);
  }
}
```

## ğŸ” **ê¶Œí•œ & ë³´ì•ˆ ì²´ê³„**

### ğŸ”¥ ê°œì„ ëœ ê¶Œí•œ ì²´ê³„ (v3.0 ì¹˜ëª…ì  ìœ„í—˜ ê°œì„ )

#### ê¶Œí•œ ë ˆë²¨ ì •ì˜
```typescript
enum UserRole {
  SYSTEM_ADMIN = 'system_admin',  // ëª¨ë“  ê¸°ëŠ¥ ì ‘ê·¼
  TEAM_LEADER = 'team_leader',    // íŒ€ ë°ì´í„° ê´€ë¦¬
  PART_LEADER = 'part_leader',    // íŒŒíŠ¸ ë°ì´í„° ê´€ë¦¬  
  MEMBER = 'member'               // ê°œì¸ ë°ì´í„°ë§Œ
}

// ğŸ”¥ ì‹ ê·œ: ê¶Œí•œ ìœ„ì„ í…Œì´ë¸” (íœ´ê°€/ì¶œì¥ ëŒ€ì‘)
permission_delegations (
  id BIGSERIAL PRIMARY KEY,
  from_user_id BIGINT REFERENCES users(id),
  to_user_id BIGINT REFERENCES users(id),
  delegated_role VARCHAR(20),     -- ìœ„ì„í•  ì—­í• 
  delegated_teams TEXT[],          -- ìœ„ì„í•  íŒ€ ëª©ë¡ (ë³µìˆ˜ ê°€ëŠ¥)
  start_date TIMESTAMP NOT NULL,
  end_date TIMESTAMP NOT NULL,
  reason VARCHAR(200),            -- ìœ„ì„ ì‚¬ìœ 
  is_active BOOLEAN DEFAULT true,
  created_at TIMESTAMP DEFAULT NOW(),
  approved_by BIGINT REFERENCES users(id),
  approved_at TIMESTAMP
);

// ğŸ”¥ ì‹ ê·œ: ë³µìˆ˜ íŒ€ ì†Œì† ì§€ì› (í˜‘ì—…/ê²¸ì§)
user_team_mappings (
  id BIGSERIAL PRIMARY KEY,
  user_id BIGINT REFERENCES users(id),
  team VARCHAR(50) NOT NULL,
  is_primary BOOLEAN DEFAULT false,  -- ì£¼ ì†Œì†íŒ€
  role_in_team VARCHAR(20),          -- íŒ€ ë‚´ ì—­í• 
  start_date DATE NOT NULL,
  end_date DATE,                     -- NULLì´ë©´ í˜„ì¬ ì†Œì†
  created_at TIMESTAMP DEFAULT NOW(),
  UNIQUE(user_id, team, start_date)
);

// ğŸ”¥ ê°œì„ ëœ ê¶Œí•œ ë§¤íŠ¸ë¦­ìŠ¤
ê¶Œí•œë³„ ì ‘ê·¼ ë²”ìœ„:
- SYSTEM_ADMIN: ëª¨ë“  ë°ì´í„° CRUD + ì‹œìŠ¤í…œ ì„¤ì •
- TEAM_LEADER: 
  * ì†Œì† íŒ€(ë³µìˆ˜) ì „ì²´ ë°ì´í„° CRUD
  * íƒ€ íŒ€ ë°ì´í„° ì½ê¸° ì „ìš© (í˜‘ì—… ì§€ì›)
  * ê¶Œí•œ ìœ„ì„ ìŠ¹ì¸/ìƒì„± ê°€ëŠ¥
- PART_LEADER:
  * ì†Œì† íŒŒíŠ¸ ë°ì´í„° CRUD
  * ê°™ì€ íŒ€ ë‚´ íƒ€ íŒŒíŠ¸ ì½ê¸° ì „ìš©
  * ì œí•œì  ê¶Œí•œ ìœ„ì„ ìš”ì²­ ê°€ëŠ¥
- MEMBER:
  * ë³¸ì¸ ë‹´ë‹¹ ë°ì´í„° CRUD
  * íŒ€ ë‚´ ê³µê°œ ë°ì´í„° ì½ê¸°
  * ìœ„ì„ë°›ì€ ê¶Œí•œ í•œì‹œì  í–‰ì‚¬
```

## ğŸ”„ **ë°ì´í„° ì²˜ë¦¬ ì •ì±… (v3.0 ì¹˜ëª…ì  ìœ„í—˜ ê°œì„ )**

### ğŸ”¥ íŒ€ ë³€ê²½ ì‹œ ë°ì´í„° ì²˜ë¦¬
```typescript
// íŒ€ ë³€ê²½ í”„ë¡œì„¸ìŠ¤
interface TeamChangeProcess {
  // 1ë‹¨ê³„: ë³€ê²½ ìš”ì²­
  request: {
    user_id: number;
    from_team: string;
    to_team: string;
    change_date: Date;
    reason: string;
  };
  
  // 2ë‹¨ê³„: ë°ì´í„° ì²˜ë¦¬
  dataHandling: {
    ongoing_tasks: 'TRANSFER' | 'REASSIGN' | 'COMPLETE';  // ì§„í–‰ì¤‘ ì—…ë¬´
    completed_tasks: 'KEEP_ORIGINAL' | 'COPY_TO_NEW';     // ì™„ë£Œ ì—…ë¬´
    files: 'MAINTAIN_ACCESS' | 'TRANSFER_OWNERSHIP';      // íŒŒì¼
    permissions: 'RESET' | 'MERGE';                        // ê¶Œí•œ
  };
  
  // 3ë‹¨ê³„: ì¸ìˆ˜ì¸ê³„
  handover: {
    tasks_to_handover: number[];     // ì¸ê³„í•  ì—…ë¬´ ID
    new_assignee: number;             // ì¸ìˆ˜ì
    handover_note: string;            // ì¸ìˆ˜ì¸ê³„ ë…¸íŠ¸
    completed_at: Date;
  };
}

// íŒ€ ë³€ê²½ ì²˜ë¦¬ API
POST /api/users/:id/team-change
{
  "to_team": "ê°œë°œíŒ€",
  "change_date": "2024-02-01",
  "ongoing_tasks_handling": "REASSIGN",
  "new_assignee_id": 5
}
```

### ğŸ”¥ ì‚¬ìš©ì í‡´ì‚¬ ì²˜ë¦¬
```sql
-- í‡´ì‚¬ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤ í…Œì´ë¸”
resignation_processes (
  id BIGSERIAL PRIMARY KEY,
  user_id BIGINT REFERENCES users(id),
  resignation_date DATE NOT NULL,
  status VARCHAR(20) DEFAULT 'PENDING', -- PENDING, IN_PROGRESS, COMPLETED
  
  -- ì—…ë¬´ ì¸ê³„
  task_handover_to BIGINT REFERENCES users(id),
  task_handover_completed BOOLEAN DEFAULT false,
  task_handover_note TEXT,
  
  -- íŒŒì¼ ì²˜ë¦¬
  file_transfer_to BIGINT REFERENCES users(id),
  file_transfer_completed BOOLEAN DEFAULT false,
  
  -- ê¶Œí•œ íšŒìˆ˜
  permission_revoked BOOLEAN DEFAULT false,
  account_deactivated BOOLEAN DEFAULT false,
  
  processed_by BIGINT REFERENCES users(id),
  processed_at TIMESTAMP,
  created_at TIMESTAMP DEFAULT NOW()
);

-- í‡´ì‚¬ ì²˜ë¦¬ ì²´í¬ë¦¬ìŠ¤íŠ¸
resignation_checklists (
  id BIGSERIAL PRIMARY KEY,
  process_id BIGINT REFERENCES resignation_processes(id),
  item_type VARCHAR(50), -- TASK, FILE, PERMISSION, ACCOUNT
  item_id BIGINT,
  action VARCHAR(50), -- TRANSFER, ARCHIVE, DELETE
  target_user_id BIGINT REFERENCES users(id),
  completed BOOLEAN DEFAULT false,
  completed_at TIMESTAMP
);
```

### ğŸ”¥ KPI-ì—…ë¬´ ì—°ë™ ë°ì´í„° ë™ê¸°í™”
```typescript
// KPI ì‚­ì œ ì‹œ ì—°ê´€ ì—…ë¬´ ì²˜ë¦¬
interface KpiDeletionPolicy {
  // KPI ìƒíƒœì— ë”°ë¥¸ ì²˜ë¦¬
  handleLinkedTasks(kpiId: number): {
    if_kpi_active: 'PREVENT_DELETION';      // í™œì„± KPIëŠ” ì‚­ì œ ë¶ˆê°€
    if_kpi_completed: 'MAINTAIN_REFERENCE'; // ì™„ë£Œ KPIëŠ” ì°¸ì¡° ìœ ì§€
    if_kpi_cancelled: 'REMOVE_REFERENCE';   // ì·¨ì†Œ KPIëŠ” ì°¸ì¡° ì œê±°
  };
  
  // ì—°ê´€ ì—…ë¬´ ì•Œë¦¼
  notifyAffectedUsers: boolean;
  
  // ê°ì‚¬ ë¡œê·¸
  auditLog: {
    action: 'KPI_DELETION_ATTEMPTED' | 'KPI_DELETED';
    affected_tasks: number[];
    prevented_reason?: string;
  };
}

// KPI ë³€ê²½ ì‹œ ì—…ë¬´ ë™ê¸°í™”
@Injectable()
export class KpiTaskSyncService {
  async syncKpiChanges(kpiId: number, changes: Partial<KpiEntity>) {
    // 1. ì—°ê´€ëœ ì—…ë¬´ ì°¾ê¸°
    const linkedTasks = await this.taskRepo.find({
      where: { loaded_kpi_id: kpiId }
    });
    
    // 2. ì¤‘ìš” í•„ë“œ ë³€ê²½ ì‹œ ì—…ë¬´ ì—…ë°ì´íŠ¸
    if (changes.title || changes.status) {
      for (const task of linkedTasks) {
        task.loaded_kpi_title = changes.title || task.loaded_kpi_title;
        // ìƒíƒœ ë™ê¸°í™” ê·œì¹™ ì ìš©
        if (changes.status === 'CANCELLED') {
          task.taskType = 'ì¼ë°˜'; // KPI ì—°ê²° í•´ì œ
        }
      }
    }
    
    // 3. ë³€ê²½ ì´ë ¥ ê¸°ë¡
    await this.auditService.log({
      entity: 'KPI_TASK_SYNC',
      action: 'UPDATE',
      details: { kpiId, changes, affectedTasks: linkedTasks.length }
    });
  }
}

### ë³´ì•ˆ ì •ì±…
```typescript
// ë¹„ë°€ë²ˆí˜¸ ì •ì±…
- ìµœì†Œ 8ìë¦¬ + íŠ¹ìˆ˜ë¬¸ì í¬í•¨
- JWT í† í° ë§Œë£Œ: 8ì‹œê°„
- Refresh í† í°: 7ì¼

// íŒŒì¼ ë³´ì•ˆ (ğŸ”¥ ê²€ì¦ ê²°ê³¼ ê°•í™”)
- ì—…ë¡œë“œ ì œí•œ: 100MB
- í—ˆìš© íƒ€ì…: PDF, Office ë¬¸ì„œ, ì´ë¯¸ì§€ë§Œ (í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸)
- ê¸ˆì§€ íƒ€ì…: ì‹¤í–‰íŒŒì¼, ìŠ¤í¬ë¦½íŠ¸ íŒŒì¼ (ë¸”ë™ë¦¬ìŠ¤íŠ¸)
- íŒŒì¼ëª… ê²€ì¦: ê²½ë¡œ ì¡°ì‘ ë°©ì§€
- ë°”ì´ëŸ¬ìŠ¤ ìŠ¤ìº”: ZIP/ì••ì¶•íŒŒì¼ í•„ìˆ˜

// ë°±ì—… ì •ì±…
- DB ë°±ì—…: ë§¤ì£¼ ì¼ìš”ì¼ ìƒˆë²½ 2ì‹œ
- íŒŒì¼ ë°±ì—…: ë§¤ì£¼ ì¼ìš”ì¼ ìƒˆë²½ 3ì‹œ
- ë°±ì—… ë³´ê´€: 4ì£¼ë¶„
```

## ğŸ”„ **ìë™í™” & ì•Œë¦¼ ì‹œìŠ¤í…œ**

### Cron Jobs
```typescript
// ë¼ì´ì„ ìŠ¤ ë§Œë£Œ ì•Œë¦¼
@Cron('0 9 * * 1') // ë§¤ì£¼ ì›”ìš”ì¼ 9ì‹œ
async checkLicenseExpiry() {
  // 30ì¼ ì´ë‚´ ë§Œë£Œ ë¼ì´ì„ ìŠ¤ ì•Œë¦¼
}

// ì—…ë¬´ ë§ˆê°ì¼ ì•Œë¦¼  
@Cron('0 9 * * *') // ë§¤ì¼ 9ì‹œ
async taskDeadlineReminder() {
  // 7ì¼ì „, 3ì¼ì „, 1ì¼ì „, ë‹¹ì¼ ì•Œë¦¼
}

// ë°±ì—… ì‹¤í–‰
@Cron('0 2 * * 0') // ë§¤ì£¼ ì¼ìš”ì¼ 2ì‹œ
async performBackup() {
  // DB + íŒŒì¼ ë°±ì—…
}

// ê°ì‚¬ë¡œê·¸ ì•„ì¹´ì´ë¹™
@Cron('0 1 1 * *') // ë§¤ì›” 1ì¼ 1ì‹œ
async archiveAuditLogs() {
  // 1ë…„ ì´ìƒ ë¡œê·¸ â†’ archive í…Œì´ë¸”
}
```

### ì•Œë¦¼ ì¢…ë¥˜
```typescript
enum NotificationType {
  TASK_ASSIGNED = 'task_assigned',           // ì—…ë¬´ í• ë‹¹
  TASK_DEADLINE = 'task_deadline',           // ì—…ë¬´ ë§ˆê°ì„ë°•
  LICENSE_EXPIRY = 'license_expiry',         // ë¼ì´ì„ ìŠ¤ ë§Œë£Œ
  SECURITY_INCIDENT = 'security_incident',   // ë³´ì•ˆì‚¬ê³ 
  EDUCATION_DUE = 'education_due',           // êµìœ¡ ì´ìˆ˜ê¸°í•œ
  INSPECTION_DUE = 'inspection_due'          // ì ê²€ ì‹¤ì‹œê¸°í•œ
}
```

## ğŸ› ï¸ **API ì—”ë“œí¬ì¸íŠ¸ ì„¤ê³„**

### ì¸ì¦ API
```typescript
POST /api/auth/login
POST /api/auth/logout  
POST /api/auth/refresh
GET  /api/auth/profile
PUT  /api/auth/change-password
```

### ê´€ë¦¬ì ë©”ë‰´ API
```typescript
// ë§ˆìŠ¤í„°ì½”ë“œ (SYSTEM_ADMINë§Œ)
GET    /api/admin/master-codes
POST   /api/admin/master-codes
PUT    /api/admin/master-codes/:id
DELETE /api/admin/master-codes/:id

// ì‹œìŠ¤í…œ ì„¤ì •
GET    /api/admin/system-settings
PUT    /api/admin/system-settings

// ì²´í¬ë¦¬ìŠ¤íŠ¸ í…œí”Œë¦¿
GET    /api/admin/checklist-templates
POST   /api/admin/checklist-templates
PUT    /api/admin/checklist-templates/:id
DELETE /api/admin/checklist-templates/:id

// ì‚¬ìš©ì ì„¤ì •
GET    /api/admin/user-settings/:userId
PUT    /api/admin/user-settings/:userId
```

### ë©”ì¸ ë©”ë‰´ API (í˜„ì¬ í”„ë¡ íŠ¸ì—”ë“œì™€ ì™„ì „ ì¼ì¹˜)
```typescript
// ëŒ€ì‹œë³´ë“œ
GET  /api/dashboard/widgets          // ì‚¬ìš©ìë³„ ìœ„ì ¯ ì„¤ì • ì¡°íšŒ
POST /api/dashboard/widgets          // ìƒˆ ìœ„ì ¯ ì¶”ê°€
PUT  /api/dashboard/widgets/:id      // ìœ„ì ¯ ì„¤ì • ë³€ê²½
DELETE /api/dashboard/widgets/:id    // ìœ„ì ¯ ì‚­ì œ
GET  /api/dashboard/stats            // ëŒ€ì‹œë³´ë“œ í†µê³„ ë°ì´í„°
  // Response: { myTasks: {...}, teamKpi: {...}, costStatus: {...}, todaySchedule: [...], notices: [...] }

// ì—…ë¬´ê´€ë¦¬ (TaskEditDialogì™€ ì™„ì „ ì¼ì¹˜)
GET    /api/tasks                    // ì—…ë¬´ ëª©ë¡ ì¡°íšŒ
  // Query: ?team=ê°œë°œíŒ€&status=ì§„í–‰&assignee=ê¹€ì² ìˆ˜&page=1&limit=20
  // Response: TaskTableData[]
GET    /api/tasks/:id                // íŠ¹ì • ì—…ë¬´ ìƒì„¸ ì¡°íšŒ
POST   /api/tasks                    // ìƒˆ ì—…ë¬´ ë“±ë¡
  // Body: { workContent, description, taskType, status, assignee, team, department, progress, registrationDate, startDate, completedDate }
PUT    /api/tasks/:id                // ì—…ë¬´ ìˆ˜ì •
DELETE /api/tasks/:id                // ì—…ë¬´ ì‚­ì œ (ë…¼ë¦¬ì‚­ì œ)

// ì—…ë¬´ ì²´í¬ë¦¬ìŠ¤íŠ¸ (ê³„ì¸µêµ¬ì¡° ì§€ì›)
GET    /api/tasks/:id/checklists     // ì—…ë¬´ì˜ ì²´í¬ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
POST   /api/tasks/:id/checklists     // ìƒˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª© ì¶”ê°€
PUT    /api/tasks/:id/checklists/:itemId  // ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª© ìˆ˜ì •
DELETE /api/tasks/:id/checklists/:itemId  // ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª© ì‚­ì œ
PUT    /api/tasks/:id/checklists/:itemId/toggle  // ì²´í¬ë°•ìŠ¤ í† ê¸€

// ì—…ë¬´ ëŒ“ê¸€ (ê¸°ë¡íƒ­)
GET    /api/tasks/:id/comments       // ì—…ë¬´ ëŒ“ê¸€ ëª©ë¡
POST   /api/tasks/:id/comments       // ìƒˆ ëŒ“ê¸€ ì¶”ê°€
PUT    /api/tasks/:id/comments/:commentId  // ëŒ“ê¸€ ìˆ˜ì •
DELETE /api/tasks/:id/comments/:commentId  // ëŒ“ê¸€ ì‚­ì œ

// ì—…ë¬´ íŒŒì¼ (ìë£Œíƒ­)
GET    /api/tasks/:id/files          // ì—…ë¬´ ì²¨ë¶€íŒŒì¼ ëª©ë¡
POST   /api/tasks/:id/files          // íŒŒì¼ ì—…ë¡œë“œ
DELETE /api/tasks/:id/files/:fileId  // íŒŒì¼ ì‚­ì œ
GET    /api/tasks/:id/files/:fileId/download  // íŒŒì¼ ë‹¤ìš´ë¡œë“œ

// KPIê´€ë¦¬ (KpiEditDialogì™€ ì™„ì „ ì¼ì¹˜)
GET    /api/kpis                     // KPI ëª©ë¡ ì¡°íšŒ
  // Query: ?team=ê°œë°œíŒ€&status=ì§„í–‰&assignee=ê¹€ì² ìˆ˜
GET    /api/kpis/:id                 // íŠ¹ì • KPI ìƒì„¸ ì¡°íšŒ
POST   /api/kpis                     // ìƒˆ KPI ë“±ë¡
PUT    /api/kpis/:id                 // KPI ìˆ˜ì • (is_locked ì²´í¬)
DELETE /api/kpis/:id                 // KPI ì‚­ì œ (ë…¼ë¦¬ì‚­ì œ)

// KPI ì²´í¬ë¦¬ìŠ¤íŠ¸ (ì—…ë¬´ì™€ ë™ì¼í•œ êµ¬ì¡°)
GET    /api/kpis/:id/checklists      // KPI ì²´í¬ë¦¬ìŠ¤íŠ¸ ì¡°íšŒ
POST   /api/kpis/:id/checklists      // ìƒˆ ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª© ì¶”ê°€
PUT    /api/kpis/:id/checklists/:itemId     // ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª© ìˆ˜ì •
DELETE /api/kpis/:id/checklists/:itemId     // ì²´í¬ë¦¬ìŠ¤íŠ¸ í•­ëª© ì‚­ì œ
PUT    /api/kpis/:id/checklists/:itemId/toggle  // ì²´í¬ë°•ìŠ¤ í† ê¸€

// KPI íŒ€ë³„ ì¡°íšŒ (ì—…ë¬´ê´€ë¦¬ì—ì„œ "KPI ë¶ˆëŸ¬ì˜¤ê¸°"ìš©)
GET    /api/kpis/team/:teamName      // íŠ¹ì • íŒ€ì˜ KPI ëª©ë¡
  // Response: KPI ëª©ë¡ + ì²´í¬ë¦¬ìŠ¤íŠ¸ ê³„ì¸µêµ¬ì¡°

// KPI ëŒ“ê¸€ ë° íŒŒì¼ (ì—…ë¬´ì™€ ë™ì¼)
GET    /api/kpis/:id/comments        // KPI ëŒ“ê¸€ ëª©ë¡
POST   /api/kpis/:id/comments        // ìƒˆ ëŒ“ê¸€ ì¶”ê°€
GET    /api/kpis/:id/files           // KPI ì²¨ë¶€íŒŒì¼ ëª©ë¡
POST   /api/kpis/:id/files           // íŒŒì¼ ì—…ë¡œë“œ

// ì¼ì •ê´€ë¦¬
GET    /api/calendar/events          // ì¼ì • ëª©ë¡ ì¡°íšŒ
  // Query: ?start=2024-01-01&end=2024-01-31&type=meeting
POST   /api/calendar/events          // ìƒˆ ì¼ì • ë“±ë¡
PUT    /api/calendar/events/:id      // ì¼ì • ìˆ˜ì •
DELETE /api/calendar/events/:id      // ì¼ì • ì‚­ì œ

// ê°œì¸êµìœ¡ê´€ë¦¬
GET    /api/personal-educations      // ê°œì¸êµìœ¡ ëª©ë¡ ì¡°íšŒ
  // Query: ?participant=userId&status=ì§„í–‰ì¤‘
POST   /api/personal-educations      // ìƒˆ êµìœ¡ ë“±ë¡
PUT    /api/personal-educations/:id  // êµìœ¡ ì •ë³´ ìˆ˜ì •
DELETE /api/personal-educations/:id  // êµìœ¡ ì‚­ì œ
POST   /api/personal-educations/:id/complete  // êµìœ¡ ì™„ë£Œ ì²˜ë¦¬

// ë¹„ìš©ê´€ë¦¬
GET    /api/costs                    // ë¹„ìš© ëª©ë¡ ì¡°íšŒ
  // Query: ?category=ìš´ì˜ë¹„&status=ìŠ¹ì¸&requestedBy=userId
POST   /api/costs                    // ìƒˆ ë¹„ìš© ì‹ ì²­
PUT    /api/costs/:id                // ë¹„ìš© ì •ë³´ ìˆ˜ì •
DELETE /api/costs/:id                // ë¹„ìš© ì‚­ì œ
POST   /api/costs/:id/approve        // ë¹„ìš© ìŠ¹ì¸
POST   /api/costs/:id/reject         // ë¹„ìš© ë°˜ë ¤
GET    /api/costs/:id/files          // ë¹„ìš© ì²¨ë¶€íŒŒì¼ ëª©ë¡
POST   /api/costs/:id/files          // ë¹„ìš© íŒŒì¼ ì—…ë¡œë“œ
```

### ê¸°íš ë©”ë‰´ API
```typescript
// ë§¤ì¶œê´€ë¦¬
GET  /api/planning/sales
POST /api/planning/sales
GET  /api/planning/sales/analytics

// íˆ¬ìê´€ë¦¬
GET  /api/planning/investments
POST /api/planning/investments
PUT  /api/planning/investments/:id
GET  /api/planning/investments/:id/milestones
```

### IT ë©”ë‰´ API
```typescript
// VOCê´€ë¦¬
GET  /api/it/vocs
POST /api/it/vocs
PUT  /api/it/vocs/:id
POST /api/it/vocs/:id/response

// ì†”ë£¨ì…˜ê´€ë¦¬
GET  /api/it/solutions
POST /api/it/solutions
PUT  /api/it/solutions/:id
POST /api/it/solutions/:id/assign

// í•˜ë“œì›¨ì–´ê´€ë¦¬
GET  /api/it/hardware
POST /api/it/hardware
PUT  /api/it/hardware/:id
POST /api/it/hardware/:id/maintenance

// ì†Œí”„íŠ¸ì›¨ì–´ê´€ë¦¬
GET  /api/it/software
POST /api/it/software
PUT  /api/it/software/:id
GET  /api/it/software/:id/license-status
GET  /api/it/licenses/expiring      // ë§Œë£Œ ì˜ˆì • ëª©ë¡

// ITêµìœ¡ê´€ë¦¬
GET  /api/it/educations
POST /api/it/educations
PUT  /api/it/educations/:id
POST /api/it/educations/:id/enroll
```

### ë³´ì•ˆ ë©”ë‰´ API
```typescript
// ë³´ì•ˆì ê²€ê´€ë¦¬
GET  /api/security/inspections
POST /api/security/inspections
PUT  /api/security/inspections/:id
POST /api/security/inspections/:id/items

// ë³´ì•ˆêµìœ¡ê´€ë¦¬
GET  /api/security/educations
POST /api/security/educations
PUT  /api/security/educations/:id
POST /api/security/educations/:id/enroll

// ë³´ì•ˆì‚¬ê³ ê´€ë¦¬
GET  /api/security/incidents
POST /api/security/incidents
PUT  /api/security/incidents/:id
POST /api/security/incidents/:id/escalate
POST /api/security/incidents/:id/actions

// ë³´ì•ˆê·œì •ê´€ë¦¬
GET  /api/security/regulations
POST /api/security/regulations
PUT  /api/security/regulations/:id
POST /api/security/regulations/:id/acknowledge
GET  /api/security/regulations/:id/views
```

### AI ëŒ€í™” API
```typescript
POST /api/ai/chat                    // ë©”ì‹œì§€ ì „ì†¡
GET  /api/ai/conversations           // ëŒ€í™” ì´ë ¥
GET  /api/ai/prompts                 // í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
DELETE /api/ai/conversations/:id     // ëŒ€í™” ì‚­ì œ
```

### ê³µí†µ API
```typescript
// íŒŒì¼ ê´€ë¦¬
POST   /api/files/upload             // 100MB ì œí•œ
GET    /api/files/:id/download
DELETE /api/files/:id

// ê°ì‚¬ë¡œê·¸
GET    /api/audit-logs               // ê¶Œí•œë³„ ì¡°íšŒ
GET    /api/audit-logs/export        // Excel ë‹¤ìš´ë¡œë“œ

// ì•Œë¦¼
GET    /api/notifications
PUT    /api/notifications/:id/read
POST   /api/notifications/settings
DELETE /api/notifications/:id

// ë§ˆìŠ¤í„°ì½”ë“œ ì¡°íšŒ (ëª¨ë“  ì‚¬ìš©ì)
GET    /api/master-codes/:category
```

## ğŸš€ **ì„±ëŠ¥ ìµœì í™” ì„¤ê³„ (ğŸ”¥ ê²€ì¦ ê²°ê³¼ ì¶”ê°€)**

### í•„ìˆ˜ ë°ì´í„°ë² ì´ìŠ¤ ì¸ë±ìŠ¤
```sql
-- ğŸ” í•µì‹¬ ê²€ìƒ‰ ì„±ëŠ¥ ì¸ë±ìŠ¤
CREATE INDEX idx_tasks_assignee ON tasks(assignee) WHERE deleted_at IS NULL;
CREATE INDEX idx_tasks_team ON tasks(team) WHERE deleted_at IS NULL;
CREATE INDEX idx_tasks_status ON tasks(status) WHERE deleted_at IS NULL;
CREATE INDEX idx_tasks_department ON tasks(department) WHERE deleted_at IS NULL;
CREATE INDEX idx_tasks_task_type ON tasks(task_type) WHERE deleted_at IS NULL;
CREATE INDEX idx_tasks_registration_date ON tasks(registration_date DESC);

-- KPI ê²€ìƒ‰ ìµœì í™”
CREATE INDEX idx_kpis_team ON kpis(team) WHERE deleted_at IS NULL;
CREATE INDEX idx_kpis_assignee ON kpis(assignee) WHERE deleted_at IS NULL;
CREATE INDEX idx_kpis_status ON kpis(status) WHERE deleted_at IS NULL;
CREATE INDEX idx_kpis_is_locked ON kpis(is_locked) WHERE deleted_at IS NULL;

-- ì²´í¬ë¦¬ìŠ¤íŠ¸ ê³„ì¸µêµ¬ì¡° ìµœì í™”
CREATE INDEX idx_task_checklists_task_id ON task_checklists(task_id, parent_id, level);
CREATE INDEX idx_kpi_checklists_kpi_id ON kpi_checklists(kpi_id, parent_id, level);

-- íŒŒì¼ ì‹œìŠ¤í…œ ìµœì í™”
CREATE INDEX idx_task_files_task_id ON task_files(task_id) WHERE deleted_at IS NULL;
CREATE INDEX idx_kpi_files_kpi_id ON kpi_files(kpi_id) WHERE deleted_at IS NULL;

-- ê°ì‚¬ë¡œê·¸ ì„±ëŠ¥ (íŒŒí‹°ì…”ë‹ ì „ ì„ì‹œ)
CREATE INDEX idx_audit_logs_entity ON audit_logs(entity_type, entity_id, created_at DESC);
CREATE INDEX idx_audit_logs_user_date ON audit_logs(user_id, created_at DESC);

-- ë…¼ë¦¬ì‚­ì œ ìµœì í™” (ëª¨ë“  ì£¼ìš” í…Œì´ë¸”)
CREATE INDEX idx_users_deleted_at ON users(deleted_at);
CREATE INDEX idx_costs_deleted_at ON costs(deleted_at);
```

### ìºì‹± ì „ëµ
```typescript
// Redis ìºì‹œ í‚¤ ì„¤ê³„
const CACHE_KEYS = {
  MASTER_CODES: 'master_codes:',
  TEAM_USERS: 'team_users:',
  USER_PERMISSIONS: 'user_permissions:',
  SYSTEM_SETTINGS: 'system_settings'
};

// ìºì‹œ TTL ì„¤ì •
- ë§ˆìŠ¤í„°ì½”ë“œ: 1ì‹œê°„ (ìì£¼ ë³€ê²½ë˜ì§€ ì•ŠìŒ)
- ì‚¬ìš©ì ê¶Œí•œ: 30ë¶„ (ë³´ì•ˆ ì¤‘ìš”)  
- íŒ€ë³„ ì‚¬ìš©ì: 15ë¶„ (ì¡°ì§ë³€ê²½ ë°˜ì˜)
- ì‹œìŠ¤í…œ ì„¤ì •: 10ë¶„ (ì‹¤ì‹œê°„ ë°˜ì˜ í•„ìš”)
```

### ì¿¼ë¦¬ ìµœì í™” ì „ëµ
```sql
-- ê³„ì¸µêµ¬ì¡° ì²´í¬ë¦¬ìŠ¤íŠ¸ íš¨ìœ¨ì  ì¡°íšŒ (CTE ì‚¬ìš©)
WITH RECURSIVE checklist_tree AS (
  SELECT *, 0 as depth FROM task_checklists 
  WHERE task_id = ? AND parent_id IS NULL AND deleted_at IS NULL
  UNION ALL
  SELECT tc.*, ct.depth + 1 FROM task_checklists tc
  JOIN checklist_tree ct ON tc.parent_id = tc.id
  WHERE tc.deleted_at IS NULL
)
SELECT * FROM checklist_tree ORDER BY level, sort_order;

-- ì—…ë¬´ ëª©ë¡ ì¡°íšŒ ìµœì í™” (í•„í„°ë§ + í˜ì´ì§•)
SELECT t.*, COUNT(*) OVER() as total_count
FROM tasks t
WHERE t.deleted_at IS NULL
  AND (? IS NULL OR t.team = ?)
  AND (? IS NULL OR t.assignee = ?)
  AND (? IS NULL OR t.status = ?)
ORDER BY t.registration_date DESC
LIMIT ? OFFSET ?;
```

## ğŸ” **ë³´ì•ˆ ê°•í™” ì„¤ê³„ (ğŸ”¥ ê²€ì¦ ê²°ê³¼ ì¶”ê°€)**

### íŒŒì¼ ì—…ë¡œë“œ ë³´ì•ˆ ì •ì±…
```typescript
// íŒŒì¼ ì—…ë¡œë“œ ê²€ì¦ ë¡œì§
const FILE_SECURITY = {
  // í—ˆìš© íŒŒì¼ íƒ€ì… (í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸)
  ALLOWED_TYPES: [
    'application/pdf',
    'application/msword',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
    'application/vnd.ms-excel',
    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet',
    'application/vnd.ms-powerpoint',
    'application/vnd.openxmlformats-officedocument.presentationml.presentation',
    'image/jpeg', 'image/png', 'image/gif',
    'text/plain', 'text/csv'
  ],
  
  // ê¸ˆì§€ í™•ì¥ì (ë¸”ë™ë¦¬ìŠ¤íŠ¸)
  FORBIDDEN_EXTENSIONS: [
    '.exe', '.bat', '.cmd', '.scr', '.pif', '.com',
    '.js', '.vbs', '.jar', '.php', '.asp', '.jsp'
  ],
  
  // íŒŒì¼ í¬ê¸° ì œí•œ
  MAX_SIZE: 100 * 1024 * 1024, // 100MB
  
  // íŒŒì¼ëª… ê²€ì¦ ì •ê·œì‹ (ê²½ë¡œ ì¡°ì‘ ë°©ì§€)
  FILENAME_REGEX: /^[a-zA-Z0-9\-_\.\s\(\)\[\]]+$/,
  
  // ìŠ¤ìº” í•„ìˆ˜ í™•ì¥ì
  SCAN_REQUIRED: ['.zip', '.rar', '.7z', '.tar', '.gz']
};
```

### API ê¶Œí•œ Guard êµ¬í˜„
```typescript
// ì—­í•  ê¸°ë°˜ ê¶Œí•œ Guard
@Injectable()
export class RolesGuard implements CanActivate {
  constructor(private reflector: Reflector) {}

  canActivate(context: ExecutionContext): boolean {
    const requiredRoles = this.reflector.getAllAndOverride<UserRole[]>(
      'roles', [context.getHandler(), context.getClass()]
    );
    
    if (!requiredRoles) return true;
    
    const { user } = context.switchToHttp().getRequest();
    return requiredRoles.some(role => user.role === role);
  }
}

// íŒ€/ì¡°ì§ ê¸°ë°˜ ê¶Œí•œ Guard  
@Injectable()
export class TeamAccessGuard implements CanActivate {
  canActivate(context: ExecutionContext): boolean {
    const request = context.switchToHttp().getRequest();
    const { user, params, query, body } = request;
    
    // SYSTEM_ADMINì€ ëª¨ë“  ì ‘ê·¼ í—ˆìš©
    if (user.role === UserRole.SYSTEM_ADMIN) return true;
    
    // íŒ€ ë°ì´í„° ì ‘ê·¼ ê¶Œí•œ ê²€ì¦
    const targetTeam = params.team || query.team || body.team;
    if (targetTeam && user.team !== targetTeam) {
      if (user.role === UserRole.TEAM_LEADER) return false;
    }
    
    return true;
  }
}
```

## ğŸ“… **í˜„ì‹¤ì  êµ¬í˜„ ì¼ì • (9-10ì£¼) (ğŸ”¥ v3.0 ë¦¬ìŠ¤í¬ ë²„í¼ ì¶”ê°€)**

### Phase 1: ê¸°ë°˜ ì‹œìŠ¤í…œ + ê¶Œí•œ ì²´ê³„ (1.5ì£¼) ğŸ”¥
```
Week 1-1.5:
âœ… NestJS í”„ë¡œì íŠ¸ ì…‹ì—… + PostgreSQL Docker
âœ… Prisma ìŠ¤í‚¤ë§ˆ ì‘ì„± (v3.0 ê°œì„ ì‚¬í•­ í¬í•¨)
âœ… ğŸ”¥ ê¶Œí•œ ìœ„ì„ ì‹œìŠ¤í…œ êµ¬í˜„
âœ… ğŸ”¥ ë³µìˆ˜ íŒ€ ì†Œì† ì§€ì› êµ¬í˜„
âœ… JWT ì¸ì¦ + ìë™ ê°±ì‹  ë¡œì§
âœ… ê¸°ë³¸ CRUD ë³´ì¼ëŸ¬í”Œë ˆì´íŠ¸ ìƒì„±
âœ… íŒŒì¼ ì—…ë¡œë“œ ê¸°ë³¸ êµ¬ì¡°
```

### Phase 2: ì—…ë¬´ê´€ë¦¬ í•µì‹¬ êµ¬í˜„ (3ì£¼) ğŸ”¥ ë²„í¼ ì¶”ê°€
```
Week 2-3:
âœ… ì—…ë¬´ê´€ë¦¬ ê¸°ë³¸ CRUD + ì²´í¬ë¦¬ìŠ¤íŠ¸ ê¸°ë°˜
  - TaskEditDialog ê¸°ë³¸ í•„ë“œ API êµ¬í˜„
  - ì²´í¬ë¦¬ìŠ¤íŠ¸ ê³„ì¸µêµ¬ì¡° ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„  
  - ê¸°ë³¸ ì²´í¬ë¦¬ìŠ¤íŠ¸ CRUD (ë‹¨ìˆœ ë²„ì „)
  - ğŸ”¥ íŒ€ ë³€ê²½ ì²˜ë¦¬ ë¡œì§ êµ¬í˜„

Week 4:
âœ… ì—…ë¬´ê´€ë¦¬ ê³ ê¸‰ ê¸°ëŠ¥ + ë³´ì•ˆ ì™„ì„±
  - ì²´í¬ë¦¬ìŠ¤íŠ¸ ë“œë˜ê·¸ì•¤ë“œë¡­ + ì§„ì²™ìœ¨ ê´€ë¦¬
  - ëŒ“ê¸€ ì‹œìŠ¤í…œ ì™„ì „ êµ¬í˜„
  - ğŸ”¥ ê°œì„ ëœ ê¶Œí•œ Guard êµ¬í˜„ (ìœ„ì„ í¬í•¨)
  - íŒŒì¼ ë³´ì•ˆ ì •ì±… ì ìš© (í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸)
  - ì„±ëŠ¥ ì¸ë±ìŠ¤ ì ìš©
```

### Phase 3: KPIê´€ë¦¬ + ë°ì´í„° ì •ì±… (2ì£¼) ğŸ”¥
```
Week 5-6:
âœ… KPIê´€ë¦¬ ì™„ì „ êµ¬í˜„
  - KpiEditDialogì™€ 100% ì¼ì¹˜í•˜ëŠ” API  
  - ğŸ”¥ KPI-ì—…ë¬´ ë™ê¸°í™” ì„œë¹„ìŠ¤ êµ¬í˜„
  - ğŸ”¥ KPI ì‚­ì œ ì •ì±… ì ìš©
  - ì²´í¬ë¦¬ìŠ¤íŠ¸ CRUD (ì—…ë¬´ ë¡œì§ ì¬ì‚¬ìš©)
  - is_locked ì²˜ë¦¬ + ìƒíƒœ ê´€ë¦¬
  - ìºì‹± ì „ëµ ì ìš© (Redis)
âœ… ğŸ”¥ í‡´ì‚¬ ì²˜ë¦¬ í”„ë¡œì„¸ìŠ¤ êµ¬í˜„
```

### Phase 4: ê´€ë¦¬ì + ë³´ì¡° ë©”ë‰´ (1.5ì£¼)
```
Week 7-7.5:
âœ… ë§ˆìŠ¤í„°ì½”ë“œ ê´€ë¦¬ (í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹)
âœ… ì‹œìŠ¤í…œ ì„¤ì • ê´€ë¦¬
âœ… ì‚¬ìš©ì ì„¤ì • ê´€ë¦¬  
âœ… ê°ì‚¬ë¡œê·¸ ì‹œìŠ¤í…œ êµ¬í˜„
âœ… ë¹„ìš©ê´€ë¦¬ CRUD (ê¸°ë³¸)
âœ… ì¼ì •ê´€ë¦¬ CRUD (ê¸°ë³¸)
```

### Phase 5: í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ + ì•ˆì •í™” (1.5ì£¼) ğŸ”¥
```
Week 8-8.5:
âœ… í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ í…ŒìŠ¤íŠ¸
âœ… API êµ¬ì¡° ì¡°ì • ë° ë²„ê·¸ ìˆ˜ì •
âœ… ğŸ”¥ ê¶Œí•œ ìœ„ì„ UI ì—°ë™
âœ… ğŸ”¥ íŒ€ ë³€ê²½/í‡´ì‚¬ í”„ë¡œì„¸ìŠ¤ UI ì—°ë™
âœ… ì‹¤ì œ ë°ì´í„° íë¦„ ê²€ì¦
âœ… ì„±ëŠ¥ ìµœì í™” ì ìš©
```

### Phase 6: ë¦¬ìŠ¤í¬ ë²„í¼ + í™•ì¥ (1.5ì£¼) ğŸ”¥
```
Week 9-10:
âœ… ğŸ”¥ ì˜ˆìƒì¹˜ ëª»í•œ ì´ìŠˆ ëŒ€ì‘ (í•„ìˆ˜ ë²„í¼)
âœ… í†µí•© í…ŒìŠ¤íŠ¸ ë° ë²„ê·¸ ìˆ˜ì •
âœ… ì„±ëŠ¥ ë³‘ëª© ì§€ì  ìµœì í™”
âœ… ë¬¸ì„œí™” ë° ì¸ìˆ˜ì¸ê³„ ì¤€ë¹„
âœ… (ì„ íƒ) ì „ë¬¸ ëª¨ë“ˆ êµ¬í˜„
âœ… (ì„ íƒ) AI ëŒ€í™” ê¸°ë³¸ êµ¬í˜„
```

### **ğŸ¯ ìš°ì„ ìˆœìœ„ ê¸°ë°˜ êµ¬í˜„ ì „ëµ (ê²€ì¦ ê²°ê³¼ ë°˜ì˜)**
1. **MVP ìš°ì„ **: ì—…ë¬´ê´€ë¦¬ + KPIê´€ë¦¬ë§Œ ì™„ë²½ êµ¬í˜„
2. **ë³´ì•ˆ ê°•í™”**: íŒŒì¼ ì—…ë¡œë“œ ë³´ì•ˆì„ ë³„ë„ ë§ˆì¼ìŠ¤í†¤ìœ¼ë¡œ ê´€ë¦¬
3. **ì„±ëŠ¥ í™•ë³´**: ì¸ë±ìŠ¤ë¥¼ ì´ˆê¸° ë‹¨ê³„ì— ì ìš©
4. **ì ì§„ì  í™•ì¥**: ë‚˜ë¨¸ì§€ ëª¨ë“ˆì€ ê¸°ë³¸ CRUDë¶€í„° ì‹œì‘
5. **ì—°ë™ ì‹œê°„ ì¶©ë¶„ í™•ë³´**: 1ì£¼ì¼ ì—°ë™ ê¸°ê°„ìœ¼ë¡œ ì•ˆì •ì„± í™•ë³´

### **ìœ„í—˜ ì™„í™” ì „ëµ**
- ì²´í¬ë¦¬ìŠ¤íŠ¸ ë³µì¡ë„ ë‹¨ê³„ì  êµ¬í˜„ (ê¸°ë³¸ â†’ ê³„ì¸µêµ¬ì¡° â†’ ë“œë˜ê·¸ì•¤ë“œë¡­)
- íŒŒì¼ ë³´ì•ˆ ì •ì±… ë³„ë„ êµ¬í˜„ (ê¸°ë³¸ ì—…ë¡œë“œ â†’ ë³´ì•ˆ ê°•í™”)
- API êµ¬ì¡° ë³€ê²½ ê°€ëŠ¥ì„±ì„ ê³ ë ¤í•œ ìœ ì—°í•œ ì„¤ê³„

### **ê¸°ì¡´ Phase 5: ìµœì¢…í™” + ì—°ë™ (0.5ì£¼)
```
Week 5.5-6:
âœ… AI ëŒ€í™” ê¸°ë³¸ êµ¬í˜„
âœ… í”„ë¡ íŠ¸ì—”ë“œ ì—°ë™ í…ŒìŠ¤íŠ¸
âœ… ì„±ëŠ¥ ìµœì í™” (ì¸ë±ìŠ¤ ì¶”ê°€)
âœ… API ë¬¸ì„œí™” (Swagger)
âœ… ë°°í¬ ì¤€ë¹„
```

### **ë‹¨ì¶• ê°€ëŠ¥í•œ ì´ìœ **
1. **í˜„ì¬ í”„ë¡ íŠ¸ì—”ë“œ ê¸°ë°˜ ì„¤ê³„**: ìš”êµ¬ì‚¬í•­ì´ ëª…í™•í•¨
2. **í•˜ì´ë¸Œë¦¬ë“œ ì ‘ê·¼**: ë³µì¡í•œ ì •ê·œí™” ì—†ì´ ë¹ ë¥¸ êµ¬í˜„
3. **í•µì‹¬ ëª¨ë“ˆ ìš°ì„ **: ì—…ë¬´/KPIë§Œ ì™„ë²½í•˜ê²Œ êµ¬í˜„
4. **ë‹¨ê³„ì  í™•ì¥**: ë‚˜ë¨¸ì§€ ëª¨ë“ˆì€ ê¸°ë³¸ CRUDë¡œ ì‹œì‘

## ğŸ—„ï¸ **PostgreSQL ì„¤ì • ê°€ì´ë“œ**

### Dockerë¡œ PostgreSQL ì‹¤í–‰ (ì¶”ì²œ)
```yaml
# docker-compose.yml
version: '3.8'
services:
  postgres:
    image: postgres:15
    container_name: mainly-postgres
    environment:
      POSTGRES_DB: mainly_db
      POSTGRES_USER: mainly_user
      POSTGRES_PASSWORD: mainly_password
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data
      - ./backups:/backups
    restart: unless-stopped

  redis:
    image: redis:7-alpine
    container_name: mainly-redis
    ports:
      - "6379:6379"
    restart: unless-stopped

volumes:
  postgres_data:
```

### NestJSì—ì„œ PostgreSQL ì—°ê²°

#### í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
```bash
npm install @prisma/client prisma
npm install @nestjs/config
npm install bcrypt @types/bcrypt
npm install @nestjs/passport passport passport-jwt passport-local
npm install @nestjs/jwt
npm install @nestjs/schedule
npm install class-validator class-transformer
npm install @nestjs/swagger swagger-ui-express
```

#### Prisma ì„¤ì •
```bash
# Prisma ì´ˆê¸°í™”
npx prisma init

# ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±
npx prisma migrate dev --name init

# Prisma Client ìƒì„±
npx prisma generate

# Prisma Studio (DB ê´€ë¦¬ GUI)
npx prisma studio
```

## ğŸ”§ **ê°œë°œ í™˜ê²½ ì„¤ì •**

### í™˜ê²½ë³€ìˆ˜ (.env)
```env
# Database
DATABASE_URL="postgresql://mainly_user:mainly_password@localhost:5432/mainly_db"
REDIS_URL="redis://localhost:6379"

# JWT
JWT_SECRET="your-secret-key-here"
JWT_EXPIRE="8h"
REFRESH_EXPIRE="7d"

# File Upload
UPLOAD_PATH="./uploads"
MAX_FILE_SIZE=104857600  # 100MB

# AI Integration
AI_API_URL="https://api.openai.com/v1"
AI_API_KEY="your-ai-api-key"

# Email (ì•Œë¦¼ìš©)
SMTP_HOST="smtp.gmail.com"
SMTP_USER="your-email@gmail.com"
SMTP_PASS="your-password"

# Backup
BACKUP_PATH="./backups"
BACKUP_RETENTION_DAYS=28

# Server
PORT=3100
NODE_ENV=development
```

### ì‹¤í–‰ ìˆœì„œ
```bash
# 1. PostgreSQL ì‹¤í–‰
docker-compose up -d

# 2. ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜
npx prisma migrate dev

# 3. ì‹œë“œ ë°ì´í„° ì…ë ¥
npx prisma db seed

# 4. NestJS ì•± ì‹¤í–‰
npm run start:dev
```

## ğŸ“ **ì¶”ê°€ êµ¬í˜„ ì‚¬í•­**

### ì‹œìŠ¤í…œ ì„¤ì • ê´€ë¦¬ í•­ëª©
- ë¹„ë°€ë²ˆí˜¸ ì •ì±…: 8ê¸€ì ì´ìƒ + íŠ¹ìˆ˜ë¬¸ì í¬í•¨
- ì„¸ì…˜ íƒ€ì„ì•„ì›ƒ: 8ì‹œê°„
- íŒŒì¼ ì—…ë¡œë“œ ì œí•œ: 100MB
- ë°±ì—… ì£¼ê¸°: ë§¤ì£¼ ì¼ìš”ì¼

### ëŒ€ì‹œë³´ë“œ ìœ„ì ¯
- ë‚´ ì—…ë¬´ í˜„í™© (ì§„í–‰ì¤‘/ì™„ë£Œ/ì§€ì—°)
- íŒ€ KPI ë‹¬ì„±ë¥ 
- ì´ë²ˆë‹¬ ë¹„ìš© ì§‘í–‰ í˜„í™©
- ì˜¤ëŠ˜ì˜ ì¼ì •
- ìµœê·¼ ê³µì§€ì‚¬í•­
- ì‚¬ìš©ìë³„ ìœ„ì ¯ ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥

### íŠ¹ìˆ˜ ìš”êµ¬ì‚¬í•­
- ì—…ë¬´ê´€ë¦¬-KPI ì—°ë™: KPIì—ì„œ ì—…ë¬´ë¡œ ë¶ˆëŸ¬ì˜¨ ê²½ìš° KPI ìˆ˜ì • ë¶ˆê°€
- ë…¼ë¦¬ì  ì‚­ì œ: ëª¨ë“  ë°ì´í„°ëŠ” deleted_at í”Œë˜ê·¸ë¡œ ê´€ë¦¬
- ë³€ê²½ ì´ë ¥ ì¶”ì : ëª¨ë“  ì¤‘ìš” ë³€ê²½ì‚¬í•­ audit_logsì— ê¸°ë¡
- ë¼ì´ì„ ìŠ¤ ë§Œë£Œ ì•Œë¦¼: 30ì¼ ì „ ìë™ ì•Œë¦¼
- AI ëŒ€í™” ì´ë ¥: ì˜êµ¬ ë³´ê´€
- íŒ€-íŒŒíŠ¸ ê³„ì¸µ êµ¬ì¡°: ìµœëŒ€ 10ê°œ íŒŒíŠ¸

## ğŸš€ **ë°°í¬ ë° ìš´ì˜**

### Docker ì»¨í…Œì´ë„ˆí™”
```dockerfile
# Dockerfile
FROM node:18-alpine

WORKDIR /app

COPY package*.json ./
RUN npm ci --only=production

COPY . .
RUN npx prisma generate
RUN npm run build

EXPOSE 3100

CMD ["npm", "run", "start:prod"]
```

### ëª¨ë‹ˆí„°ë§ ë° ë¡œê¹…
- ì• í”Œë¦¬ì¼€ì´ì…˜ ë¡œê·¸: Winston logger
- API ì‘ë‹µ ì‹œê°„ ëª¨ë‹ˆí„°ë§
- ë°ì´í„°ë² ì´ìŠ¤ ì¿¼ë¦¬ ì„±ëŠ¥ ì¶”ì 
- ì—ëŸ¬ ì•Œë¦¼ ì‹œìŠ¤í…œ

ì´ ê³„íšì„œì— ë”°ë¼ êµ¬í˜„í•˜ë©´ í˜„ì¬ í”„ë¡ íŠ¸ì—”ë“œì™€ ì™„ë²½í•˜ê²Œ ì—°ë™ë˜ëŠ” í’€ìŠ¤íƒ MAINLY ì‹œìŠ¤í…œì´ ì™„ì„±ë©ë‹ˆë‹¤.